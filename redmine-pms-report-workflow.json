{
  "name": "Redmine PMS Daily Report",
  "nodes": [
    {
      "parameters": {},
      "id": "a1b2c3d4-0001-0001-0001-000000000001",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -220,
        200
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 8,
              "triggerAtMinute": 0
            }
          ]
        }
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000020",
      "name": "Schedule Morning",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -220,
        400
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 17 * * 5"
            }
          ]
        }
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000021",
      "name": "Schedule Friday PM",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -220,
        600
      ]
    },
    {
      "parameters": {
        "jsCode": "// íŠ¸ë¦¬ê±° íƒ€ì…ì— ë”°ë¥¸ ê¸°ì¤€ì¼(TODAY) ê²°ì •\n// - Manual: ì˜¤ëŠ˜\n// - Schedule Morning (08:00): ì–´ì œ (D-1)\n// - Schedule Friday PM (17:00): ì˜¤ëŠ˜ (ê¸ˆìš”ì¼)\n\n// í•œêµ­ ì‹œê°„ëŒ€ ì ìš©\nfunction getKSTDate(date = new Date()) {\n  const kstOffset = 9 * 60;\n  return new Date(date.getTime() + (kstOffset + date.getTimezoneOffset()) * 60000);\n}\n\nfunction formatDate(date) {\n  const yyyy = date.getFullYear();\n  const mm = String(date.getMonth() + 1).padStart(2, '0');\n  const dd = String(date.getDate()).padStart(2, '0');\n  return `${yyyy}-${mm}-${dd}`;\n}\n\nfunction formatShortDate(date) {\n  const yyyy = date.getFullYear();\n  const mm = String(date.getMonth() + 1).padStart(2, '0');\n  const dd = String(date.getDate()).padStart(2, '0');\n  return `${String(yyyy).slice(2)}/${mm}/${dd}`;\n}\n\nfunction isWeekend(date) {\n  const day = date.getDay();\n  return day === 0 || day === 6; // ì¼(0), í† (6)\n}\n\n// íŠ¸ë¦¬ê±° íƒ€ì… íŒë³„\nlet triggerType = 'manual';\n\n// ì…ë ¥ ë°ì´í„°ë¡œ íŠ¸ë¦¬ê±° íƒ€ì… íŒë³„\nconst inputData = $input.first()?.json || {};\nif (inputData._scheduleTrigger === 'morning') {\n  triggerType = 'morning';\n} else if (inputData._scheduleTrigger === 'friday_pm') {\n  triggerType = 'friday_pm';\n} else {\n  // ë…¸ë“œ ì´ë¦„ìœ¼ë¡œ íŒë³„ ì‹œë„\n  try {\n    $('Schedule Morning').first();\n    triggerType = 'morning';\n  } catch (e1) {\n    try {\n      $('Schedule Friday PM').first();\n      triggerType = 'friday_pm';\n    } catch (e2) {\n      triggerType = 'manual';\n    }\n  }\n}\n\nconst now = getKSTDate();\nconst currentHour = now.getHours();\n\n// ìˆ˜ë™ íŠ¸ë¦¬ê±°ê°€ ì•„ë‹Œ ê²½ìš°, ì‹œê°„ëŒ€ë¡œ ì¶”ê°€ íŒë³„\nif (triggerType !== 'manual') {\n  if (currentHour >= 12) {\n    triggerType = 'friday_pm';\n  } else {\n    triggerType = 'morning';\n  }\n}\n\n// ê¸°ì¤€ì¼ ê³„ì‚°\nlet baseDate;\nif (triggerType === 'manual') {\n  baseDate = now;\n} else if (triggerType === 'friday_pm') {\n  baseDate = now;\n} else {\n  baseDate = new Date(now);\n  baseDate.setDate(baseDate.getDate() - 1);\n}\n\nconst TODAY = formatDate(baseDate);\nconst TODAY_SHORT = formatShortDate(baseDate);\n\n// ìŠ¤í‚µ ì¡°ê±´: ìŠ¤ì¼€ì¤„ íŠ¸ë¦¬ê±° + ê¸°ì¤€ì¼ì´ ì£¼ë§\nlet shouldRun = true;\nlet skipReason = '';\n\nif (triggerType !== 'manual' && isWeekend(baseDate)) {\n  shouldRun = false;\n  skipReason = `ê¸°ì¤€ì¼(${TODAY})ì´ ì£¼ë§ì…ë‹ˆë‹¤.`;\n}\n\nreturn [{\n  json: {\n    triggerType,\n    TODAY,\n    TODAY_SHORT,\n    TODAY_DISPLAY: TODAY,\n    shouldRun,\n    skipReason,\n    executionTime: formatDate(now) + ' ' + now.toTimeString().slice(0, 5)\n  }\n}];"
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000022",
      "name": "Determine Base Date",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        400
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "condition-should-run",
              "leftValue": "={{ $json.shouldRun }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000023",
      "name": "Should Run?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        220,
        400
      ]
    },
    {
      "parameters": {},
      "id": "a1b2c3d4-0001-0001-0001-000000000100",
      "name": "Error Trigger",
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [
        0,
        600
      ]
    },
    {
      "parameters": {
        "jsCode": "// ì—ëŸ¬ ì •ë³´ ì¶”ì¶œ ë° í¬ë§·íŒ…\nconst errorData = $input.first().json;\n\n// ì—ëŸ¬ ë°œìƒ ì‹œê°„\nconst now = new Date();\nconst timestamp = now.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' });\n\n// ì—ëŸ¬ ì •ë³´ ì¶”ì¶œ\nconst execution = errorData.execution || {};\nconst workflow = errorData.workflow || {};\nconst error = execution.error || {};\n\n// ì‹¤íŒ¨í•œ ë…¸ë“œ ì •ë³´\nlet failedNode = 'Unknown';\nlet errorMessage = error.message || 'Unknown error';\nlet errorStack = '';\n\n// ì‹¤í–‰ ë°ì´í„°ì—ì„œ ì‹¤íŒ¨í•œ ë…¸ë“œ ì°¾ê¸°\nif (execution.data && execution.data.resultData) {\n  const runData = execution.data.resultData.runData || {};\n  const lastNodeExecuted = execution.data.resultData.lastNodeExecuted;\n  \n  if (lastNodeExecuted) {\n    failedNode = lastNodeExecuted;\n  }\n  \n  // ì—ëŸ¬ ìƒì„¸ ì •ë³´\n  if (error.stack) {\n    errorStack = error.stack.substring(0, 500); // ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ 500ì ì œí•œ\n  }\n}\n\n// ì—ëŸ¬ ìœ í˜• ë¶„ë¥˜\nlet errorType = 'ì¼ë°˜ ì˜¤ë¥˜';\nif (errorMessage.includes('login') || errorMessage.includes('Login') || errorMessage.includes('session') || errorMessage.includes('cookie')) {\n  errorType = 'ë¡œê·¸ì¸ ì‹¤íŒ¨';\n} else if (errorMessage.includes('CSRF') || errorMessage.includes('token')) {\n  errorType = 'CSRF í† í° ì˜¤ë¥˜';\n} else if (errorMessage.includes('Notion') || errorMessage.includes('notion')) {\n  errorType = 'Notion API ì˜¤ë¥˜';\n} else if (errorMessage.includes('Slack') || errorMessage.includes('slack')) {\n  errorType = 'Slack API ì˜¤ë¥˜';\n} else if (errorMessage.includes('timeout') || errorMessage.includes('ETIMEDOUT')) {\n  errorType = 'íƒ€ì„ì•„ì›ƒ ì˜¤ë¥˜';\n} else if (errorMessage.includes('network') || errorMessage.includes('ECONNREFUSED')) {\n  errorType = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜';\n}\n\n// Slack ë©”ì‹œì§€ í¬ë§·\nconst slackMessage = `ğŸš¨ *PMS ì¼ì¼ ë¦¬í¬íŠ¸ ì›Œí¬í”Œë¡œìš° ì‹¤íŒ¨*\n\n*ë°œìƒ ì‹œê°„:* ${timestamp}\n*ì—ëŸ¬ ìœ í˜•:* ${errorType}\n*ì‹¤íŒ¨ ë…¸ë“œ:* ${failedNode}\n*ì›Œí¬í”Œë¡œìš°:* ${workflow.name || 'Redmine PMS Daily Report'}\n\n*ì—ëŸ¬ ë©”ì‹œì§€:*\n\\`\\`\\`\n${errorMessage}\n\\`\\`\\`\n${errorStack ? `\n*ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤:*\n\\`\\`\\`\n${errorStack}\n\\`\\`\\`` : ''}`;\n\nreturn [{\n  json: {\n    channel: '#pms',\n    slackMessage,\n    errorType,\n    failedNode,\n    errorMessage,\n    timestamp\n  }\n}];"
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000101",
      "name": "Format Error Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        220,
        600
      ]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "mode": "name",
          "value": "={{ $json.channel }}"
        },
        "text": "={{ $json.slackMessage }}",
        "otherOptions": {}
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000102",
      "name": "Send Error to Slack",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [
        440,
        600
      ],
      "credentials": {
        "slackApi": {
          "id": "SLACK_CREDENTIAL_ID",
          "name": "Slack API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// í™˜ê²½ë³€ìˆ˜ì—ì„œ ì„¤ì •ê°’ ê°€ì ¸ì˜¤ê¸°\nconst REDMINE_BASE_URL = $env.REDMINE_BASE_URL || 'http://idc.watchtek.co.kr:8188/redmine';\nconst REDMINE_USERNAME = $env.REDMINE_USERNAME || '';\nconst REDMINE_PASSWORD = $env.REDMINE_PASSWORD || '';\nconst NOTION_DATABASE_ID = $env.NOTION_DATABASE_ID || '';\n\n// Determine Base Date ë…¸ë“œì—ì„œ ê¸°ì¤€ì¼ ê°€ì ¸ì˜¤ê¸°\nconst baseData = $input.first().json;\nconst TODAY = baseData.TODAY;\nconst TODAY_SHORT = baseData.TODAY_SHORT;\nconst TODAY_DISPLAY = baseData.TODAY_DISPLAY;\nconst triggerType = baseData.triggerType;\n\nreturn [{\n  json: {\n    REDMINE_BASE_URL,\n    REDMINE_USERNAME,\n    REDMINE_PASSWORD,\n    NOTION_DATABASE_ID,\n    TODAY,\n    TODAY_DISPLAY,\n    TODAY_SHORT,\n    triggerType,\n    SLACK_CHANNELS: ['#pms'],\n    PROJECTS: [\n      {\n        name: 'ê²°í•¨',\n        url: `${REDMINE_BASE_URL}/projects/dcim_adv/issues?query_id=1477&per_page=100`\n      },\n      {\n        name: 'ì‹ ê·œê¸°ëŠ¥ê°œë°œ',\n        url: `${REDMINE_BASE_URL}/projects/dcim_adv/issues?query_id=1478&per_page=100`\n      },\n      {\n        name: 'KT cloud',\n        url: `${REDMINE_BASE_URL}/projects/dcim_adv/issues?query_id=1486&per_page=100`\n      },\n      {\n        name: 'ì• í”Œë§ê³ -ì‚¬ì´íŠ¸ì§€ì›',\n        url: `${REDMINE_BASE_URL}/projects/applemango_site/issues?per_page=100&query_id=1087`\n      },\n      {\n        name: 'ì• í”Œë§ê³ -ê²°í•¨ì²˜ë¦¬',\n        url: `${REDMINE_BASE_URL}/projects/release_issues_applemango/issues?query_id=1049&per_page=100`\n      }\n    ]\n  }\n}];"
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000002",
      "name": "Set Config",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        440,
        400
      ]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "={{ $json.REDMINE_BASE_URL }}/login",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000003",
      "name": "Get Login Page",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        660,
        400
      ]
    },
    {
      "parameters": {
        "jsCode": "// ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ CSRF í† í°ê³¼ ì¿ í‚¤ ì¶”ì¶œ\nconst inputData = $input.first().json;\n\n// n8n fullResponse ì˜µì…˜ ì‚¬ìš© ì‹œ ë‹¤ì–‘í•œ ì‘ë‹µ êµ¬ì¡° ì²˜ë¦¬\nlet html = '';\nlet headers = {};\n\nif (typeof inputData === 'string') {\n  html = inputData;\n} else if (inputData.body) {\n  html = inputData.body;\n  headers = inputData.headers || {};\n} else if (inputData.data) {\n  html = inputData.data;\n  headers = inputData.headers || {};\n} else {\n  // ì‘ë‹µ êµ¬ì¡° ë””ë²„ê¹…ìš©\n  throw new Error('Unexpected response structure: ' + JSON.stringify(Object.keys(inputData)));\n}\n\n// authenticity_token ì¶”ì¶œ (ì‹¤ì œ Redmine HTML êµ¬ì¡°ì— ë§ì¶¤)\n// <input name=\"authenticity_token\" type=\"hidden\" value=\"...\" />\nconst tokenMatch = html.match(/name=\"authenticity_token\"[^>]*value=\"([^\"]+)\"/);\nconst csrfToken = tokenMatch ? tokenMatch[1] : '';\n\nif (!csrfToken) {\n  throw new Error('CSRF token not found in login page');\n}\n\n// Set-Cookie í—¤ë”ì—ì„œ ì¿ í‚¤ ì¶”ì¶œ\nlet cookies = '';\nif (headers['set-cookie']) {\n  const cookieArray = Array.isArray(headers['set-cookie']) \n    ? headers['set-cookie'] \n    : [headers['set-cookie']];\n  cookies = cookieArray.map(c => c.split(';')[0]).join('; ');\n}\n\n// ì´ì „ ë…¸ë“œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°\nconst prevData = $('Set Config').first().json;\n\nreturn [{\n  json: {\n    csrfToken,\n    cookies,\n    REDMINE_BASE_URL: prevData.REDMINE_BASE_URL,\n    REDMINE_USERNAME: prevData.REDMINE_USERNAME,\n    REDMINE_PASSWORD: prevData.REDMINE_PASSWORD,\n    NOTION_DATABASE_ID: prevData.NOTION_DATABASE_ID,\n    TODAY: prevData.TODAY,\n    TODAY_DISPLAY: prevData.TODAY_DISPLAY,\n    TODAY_SHORT: prevData.TODAY_SHORT,\n    SLACK_CHANNELS: prevData.SLACK_CHANNELS,\n    PROJECTS: prevData.PROJECTS\n  }\n}];"
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000004",
      "name": "Extract CSRF Token",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        660,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.REDMINE_BASE_URL }}/login",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Cookie",
              "value": "={{ $json.cookies }}"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "utf8",
              "value": "âœ“"
            },
            {
              "name": "authenticity_token",
              "value": "={{ $json.csrfToken }}"
            },
            {
              "name": "username",
              "value": "={{ $json.REDMINE_USERNAME }}"
            },
            {
              "name": "password",
              "value": "={{ $json.REDMINE_PASSWORD }}"
            },
            {
              "name": "login",
              "value": "ë¡œê·¸ì¸ Â»"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {
              "followRedirects": false
            }
          },
          "response": {
            "response": {
              "fullResponse": true,
              "neverError": true
            }
          }
        }
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000005",
      "name": "Login to Redmine",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        880,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// ë¡œê·¸ì¸ í›„ ì„¸ì…˜ ì¿ í‚¤ ì¶”ì¶œ\nconst response = $input.first().json;\nconst headers = response.headers || {};\nconst statusCode = response.statusCode;\nconst prevData = $('Extract CSRF Token').first().json;\n\n// ë¡œê·¸ì¸ ì„±ê³µ ì‹œ 302 ë¦¬ë‹¤ì´ë ‰íŠ¸ ë°œìƒ\nif (statusCode !== 302) {\n  throw new Error(`Login failed: Expected 302 redirect, got ${statusCode}`);\n}\n\n// ë¡œê·¸ì¸ í›„ ìƒˆë¡œ ë°œê¸‰ëœ ì„¸ì…˜ ì¿ í‚¤ë§Œ ì‚¬ìš© (ì´ì „ ì¿ í‚¤ ë¬´ì‹œ)\nlet sessionCookies = '';\n\nif (headers['set-cookie']) {\n  const cookieArray = Array.isArray(headers['set-cookie']) \n    ? headers['set-cookie'] \n    : [headers['set-cookie']];\n  sessionCookies = cookieArray.map(c => c.split(';')[0]).join('; ');\n}\n\nif (!sessionCookies) {\n  throw new Error('No session cookie received after login');\n}\n\nreturn [{\n  json: {\n    sessionCookies,\n    PROJECTS: prevData.PROJECTS,\n    TODAY: prevData.TODAY,\n    TODAY_DISPLAY: prevData.TODAY_DISPLAY,\n    TODAY_SHORT: prevData.TODAY_SHORT,\n    REDMINE_BASE_URL: prevData.REDMINE_BASE_URL,\n    NOTION_DATABASE_ID: prevData.NOTION_DATABASE_ID,\n    SLACK_CHANNELS: prevData.SLACK_CHANNELS\n  }\n}];"
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000006",
      "name": "Extract Session Cookies",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1100,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// í”„ë¡œì íŠ¸ ëª©ë¡ì„ ê°œë³„ ì•„ì´í…œìœ¼ë¡œ ë¶„ë¦¬\nconst data = $input.first().json;\nconst projects = data.PROJECTS;\n\nreturn projects.map(project => ({\n  json: {\n    projectName: project.name,\n    projectUrl: project.url,\n    sessionCookies: data.sessionCookies,\n    TODAY: data.TODAY,\n    TODAY_SHORT: data.TODAY_SHORT,\n    REDMINE_BASE_URL: data.REDMINE_BASE_URL,\n    NOTION_DATABASE_ID: data.NOTION_DATABASE_ID,\n    SLACK_CHANNELS: data.SLACK_CHANNELS,\n    TODAY_DISPLAY: data.TODAY_DISPLAY\n  }\n}));"
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000007",
      "name": "Split Projects",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1320,
        300
      ]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "={{ $json.projectUrl }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Cookie",
              "value": "={{ $json.sessionCookies }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000008",
      "name": "Get Issues Page",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1540,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// HTML íŒŒì‹±í•˜ì—¬ ì´ìŠˆ ë°ì´í„° ì¶”ì¶œ\nconst allInputItems = $input.all();\nconst allProjectItems = $('Split Projects').all();\n\nconst results = [];\n\nfor (let idx = 0; idx < allInputItems.length; idx++) {\n  const inputData = allInputItems[idx].json;\n  const projectData = allProjectItems[idx]?.json || {};\n  \n  // fullResponse ì‘ë‹µ êµ¬ì¡° ì²˜ë¦¬\n  let html = '';\n  if (typeof inputData === 'string') {\n    html = inputData;\n  } else if (inputData.data) {\n    html = inputData.data;\n  } else if (inputData.body) {\n    html = inputData.body;\n  } else {\n    continue;\n  }\n  \n  const issues = [];\n  \n  // ì´ìŠˆ ID ì¶”ì¶œ\n  const issueIdRegex = /<tr[^>]*id=\"issue-(\\d+)\"[^>]*>/gi;\n  const issueIds = [];\n  let idMatch;\n  while ((idMatch = issueIdRegex.exec(html)) !== null) {\n    issueIds.push(idMatch[1]);\n  }\n  \n  // ê° í•„ë“œë³„ë¡œ ëª¨ë“  ê°’ ì¶”ì¶œ\n  const extractAll = (regex) => {\n    const matches = [];\n    let match;\n    while ((match = regex.exec(html)) !== null) {\n      matches.push(match[1] ? match[1].trim() : '');\n    }\n    return matches;\n  };\n  \n  // ê³µí†µ ì»¬ëŸ¼ ì¶”ì¶œ\n  const subjects = extractAll(/<td class=\"subject\"><a[^>]*>([\\s\\S]*?)<\\/a><\\/td>/gi);\n  const statuses = extractAll(/<td class=\"status\">([^<]*)<\\/td>/gi);\n  const priorities = extractAll(/<td class=\"priority\">([^<]*)<\\/td>/gi);\n  const dueDates = extractAll(/<td class=\"due_date\"[^>]*>([^<]*)<\\/td>/gi);\n  const createdOns = extractAll(/<td class=\"created_on\"[^>]*>([^<]*)<\\/td>/gi);\n  const cf44s = extractAll(/<td class=\"cf_44[^\"]*\"[^>]*>([^<]*)<\\/td>/gi);\n  const closedOns = extractAll(/<td class=\"closed_on\"[^>]*>([^<]*)<\\/td>/gi);\n  const startDates = extractAll(/<td class=\"start_date\"[^>]*>([^<]*)<\\/td>/gi);\n  \n  // ë‹´ë‹¹ì ì¶”ì¶œ\n  const assignedTos = [];\n  const assignedToRegex = /<td class=\"assigned_to\"[^>]*>([\\s\\S]*?)<\\/td>/gi;\n  let assignedMatch;\n  while ((assignedMatch = assignedToRegex.exec(html)) !== null) {\n    const content = assignedMatch[1];\n    const linkMatch = content.match(/<a[^>]*>([^<]*)<\\/a>/);\n    assignedTos.push(linkMatch ? linkMatch[1].trim() : (content.trim() || 'ë¯¸ë°°ì •'));\n  }\n  \n  // ì§„ì²™ë„ ì¶”ì¶œ\n  const progresses = extractAll(/class=\"progress progress-(\\d+)\"/gi);\n  \n  // ì´ìŠˆ ê°ì²´ ìƒì„±\n  for (let i = 0; i < issueIds.length; i++) {\n    let completedDate = cf44s[i] || closedOns[i] || '';\n    \n    const issue = {\n      '#': issueIds[i],\n      'url': `http://idc.watchtek.co.kr:8188/redmine/issues/${issueIds[i]}`,\n      'ì œëª©': subjects[i] || '',\n      'ìƒíƒœ': statuses[i] || '',\n      'ìš°ì„ ìˆœìœ„': priorities[i] || '',\n      'ë‹´ë‹¹ì': assignedTos[i] || 'ë¯¸ë°°ì •',\n      'ì™„ë£Œê¸°í•œ': dueDates[i] || '',\n      'ë“±ë¡': createdOns[i] || '',\n      'ì™„ë£Œì¼': completedDate,\n      'ì§„ì²™ë„': progresses[i] ? parseInt(progresses[i]) : 0,\n      'ì‹œì‘ì‹œê°„': startDates[i] || ''\n    };\n    issues.push(issue);\n  }\n  \n  results.push({\n    json: {\n      projectName: projectData.projectName,\n      projectUrl: projectData.projectUrl,\n      issues,\n      totalItems: issues.length,\n      sessionCookies: projectData.sessionCookies,\n      TODAY: projectData.TODAY,\n      TODAY_SHORT: projectData.TODAY_SHORT,\n      REDMINE_BASE_URL: projectData.REDMINE_BASE_URL,\n      NOTION_DATABASE_ID: projectData.NOTION_DATABASE_ID,\n      SLACK_CHANNELS: projectData.SLACK_CHANNELS,\n      TODAY_DISPLAY: projectData.TODAY_DISPLAY\n    }\n  });\n}\n\nreturn results;"
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000009",
      "name": "Parse Issues HTML",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1760,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// ì´ìŠˆ ë¶„ë¥˜: ì‹ ê·œ, ì²˜ë¦¬ì™„ë£Œ, ì²˜ë¦¬ì¤‘, ì”ì—¬\nconst allItems = $input.all();\nconst results = [];\n\n// ì™„ë£Œ/ì¢…ë£Œ ìƒíƒœ ëª©ë¡ (ì²˜ë¦¬ì¤‘ì—ì„œ ì œì™¸)\nconst CLOSED_STATUSES = [\n  'ì²˜ë¦¬ ì™„ë£Œ',\n  'ì²˜ë¦¬ ë°˜ë ¤',\n  'ì¢…ë£Œ [í•´ê²°]',\n  'ì¢…ë£Œ [ë¯¸í•´ê²°]',\n  'ì¢…ë£Œ [íê¸°]',\n  'ì¢…ë£Œ [í…ŒìŠ¤íŠ¸ì˜¤ë¥˜]'\n];\n\nfor (let idx = 0; idx < allItems.length; idx++) {\n  const data = allItems[idx].json;\n  const issues = data.issues || [];\n  const today = data.TODAY;\n  \n  function normalizeDate(dateStr) {\n    if (!dateStr) return '';\n    const datePart = dateStr.split(' ')[0];\n    return datePart.replace(/\\//g, '-');\n  }\n  \n  function toShortDate(dateStr) {\n    if (!dateStr) return '-';\n    const normalized = normalizeDate(dateStr);\n    if (!normalized) return '-';\n    const parts = normalized.split('-');\n    if (parts.length === 3) {\n      return `${parts[0].slice(-2)}/${parts[1]}/${parts[2]}`;\n    }\n    return dateStr;\n  }\n  \n  function isClosedStatus(status) {\n    return CLOSED_STATUSES.some(s => status.includes(s) || s.includes(status));\n  }\n  \n  const classified = {\n    ì‹ ê·œ: [],\n    ì²˜ë¦¬ì™„ë£Œ: [],\n    ì²˜ë¦¬ì¤‘: [],\n    ì”ì—¬: []\n  };\n  \n  const REDMINE_BASE = 'http://idc.watchtek.co.kr:8188/redmine/issues/';\n  \n  issues.forEach((issue) => {\n    const registeredDate = normalizeDate(issue['ë“±ë¡']);\n    const completedDate = normalizeDate(issue['ì™„ë£Œì¼']);\n    const progress = issue['ì§„ì²™ë„'] || 0;\n    const status = issue['ìƒíƒœ'] || '';\n    \n    const issueData = {\n      id: issue['#'],\n      url: `${REDMINE_BASE}${issue['#']}`,\n      ì œëª©: issue['ì œëª©'],\n      ìš°ì„ ìˆœìœ„: issue['ìš°ì„ ìˆœìœ„'],\n      ë‹´ë‹¹ì: issue['ë‹´ë‹¹ì'],\n      ì™„ë£Œê¸°í•œ: toShortDate(issue['ì™„ë£Œê¸°í•œ']),\n      ì™„ë£Œì¼: toShortDate(issue['ì™„ë£Œì¼']),\n      ìƒíƒœ: status,\n      ì§„ì²™ë„: progress\n    };\n    \n    // 1. ì‹ ê·œ: ê¸°ì¤€ì¼ì— ë“±ë¡ëœ ì´ìŠˆ\n    if (registeredDate === today) {\n      classified.ì‹ ê·œ.push(issueData);\n    }\n    // 2. ì²˜ë¦¬ì™„ë£Œ: ê¸°ì¤€ì¼ì— ì™„ë£Œ + ì¢…ë£Œ ìƒíƒœ\n    else if (completedDate === today && isClosedStatus(status)) {\n      classified.ì²˜ë¦¬ì™„ë£Œ.push(issueData);\n    }\n    // 3. ì²˜ë¦¬ì¤‘: ì™„ë£Œì¼ ì—†ìŒ + ì§„ì²™ë„ 10~79% + ì¢…ë£Œ ìƒíƒœ ì•„ë‹˜\n    else if (!completedDate && progress >= 10 && progress < 80 && !isClosedStatus(status)) {\n      classified.ì²˜ë¦¬ì¤‘.push(issueData);\n    }\n    // 4. ì”ì—¬: ì§„ì²™ë„ 80% ë¯¸ë§Œ\n    else if (progress < 80) {\n      classified.ì”ì—¬.push(issueData);\n    }\n  });\n  \n  results.push({\n    json: {\n      projectName: data.projectName,\n      classified,\n      counts: {\n        ì‹ ê·œ: classified.ì‹ ê·œ.length,\n        ì²˜ë¦¬ì™„ë£Œ: classified.ì²˜ë¦¬ì™„ë£Œ.length,\n        ì²˜ë¦¬ì¤‘: classified.ì²˜ë¦¬ì¤‘.length,\n        ì”ì—¬: classified.ì”ì—¬.length\n      },\n      TODAY: data.TODAY,\n      TODAY_SHORT: data.TODAY_SHORT,\n      TODAY_DISPLAY: data.TODAY_DISPLAY,\n      NOTION_DATABASE_ID: data.NOTION_DATABASE_ID,\n      SLACK_CHANNELS: data.SLACK_CHANNELS\n    }\n  });\n}\n\nreturn results;"
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000010",
      "name": "Classify Issues",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1980,
        300
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {
          "destinationFieldName": "projectsData"
        }
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000011",
      "name": "Aggregate Projects",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2200,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// ì „ì²´ í”„ë¡œì íŠ¸ ë°ì´í„°ë¥¼ Notion API í˜•ì‹ìœ¼ë¡œ ë³€í™˜\n// Notion API ì œí•œ: children ìµœëŒ€ 100ê°œ â†’ í˜ì´ì§€ ìƒì„± í›„ appendë¡œ ì¶”ê°€\nconst MAX_BLOCKS_PER_REQUEST = 100;\n\nconst allItems = $input.all();\n\nlet projectsData = [];\n\n// Aggregate ë…¸ë“œ ì¶œë ¥ ì²˜ë¦¬\nif (allItems.length > 0) {\n  const firstItem = allItems[0].json;\n  \n  if (Array.isArray(firstItem.data)) {\n    projectsData = firstItem.data;\n  } else if (Array.isArray(firstItem.projectsData)) {\n    projectsData = firstItem.projectsData;\n  } else if (firstItem.projectName) {\n    projectsData = allItems.map(item => item.json);\n  } else {\n    for (const key of Object.keys(firstItem)) {\n      if (Array.isArray(firstItem[key]) && firstItem[key].length > 0) {\n        const sample = firstItem[key][0];\n        if (sample && sample.projectName) {\n          projectsData = firstItem[key];\n          break;\n        }\n      }\n    }\n  }\n}\n\nif (projectsData.length === 0) {\n  throw new Error('No project data found. Check Aggregate node output.');\n}\n\nconst today = projectsData[0]?.TODAY_DISPLAY || new Date().toISOString().split('T')[0];\nconst notionDbId = projectsData[0]?.NOTION_DATABASE_ID;\nconst slackChannels = projectsData[0]?.SLACK_CHANNELS;\n\n/**\n * ì´ìŠˆë¥¼ í…ìŠ¤íŠ¸ë¡œ í¬ë§·\n */\nfunction formatIssue(issue, includeCompleted = false, includeAssignee = true) {\n  let line = `#${issue.id} [${issue.ìš°ì„ ìˆœìœ„}] ${issue.ì œëª©} (${issue.ì™„ë£Œê¸°í•œ})`;\n  if (includeCompleted && issue.ì™„ë£Œì¼ && issue.ì™„ë£Œì¼ !== '-') {\n    line += ` ì™„ë£Œ:${issue.ì™„ë£Œì¼}`;\n  }\n  if (includeAssignee) {\n    line += ` - ${issue.ë‹´ë‹¹ì}`;\n  }\n  return line;\n}\n\n/**\n * Notion rich_text ë°°ì—´ ìƒì„±\n */\nfunction createRichText(text) {\n  return [{ type: 'text', text: { content: text } }];\n}\n\n/**\n * Notion bulleted_list_item ë¸”ë¡ ìƒì„±\n */\nfunction createBulletItem(text, url = null) {\n  const richText = url \n    ? [{ type: 'text', text: { content: text, link: { url: url } } }]\n    : [{ type: 'text', text: { content: text } }];\n  \n  return {\n    object: 'block',\n    type: 'bulleted_list_item',\n    bulleted_list_item: { rich_text: richText }\n  };\n}\n\n/**\n * ì´ìŠˆ ëª©ë¡ì„ bullet ë¸”ë¡ ë°°ì—´ë¡œ ë³€í™˜ (ëª¨ë“  ì´ìŠˆ í¬í•¨)\n */\nfunction createIssueBlocks(issues, includeCompleted = false, includeAssignee = true) {\n  if (!issues || issues.length === 0) {\n    return [createBulletItem('(ì—†ìŒ)')];\n  }\n  \n  return issues.map(issue => {\n    const text = formatIssue(issue, includeCompleted, includeAssignee);\n    return createBulletItem(text, issue.url);\n  });\n}\n\n// ëª¨ë“  Notion children ë¸”ë¡ ìˆ˜ì§‘\nlet allChildren = [];\n\n// Slack ìš”ì•½ (ë¨¼ì € ìˆ˜ì§‘)\nlet slackSummary = [];\nprojectsData.forEach((project) => {\n  const { projectName, counts } = project;\n  if (counts) {\n    slackSummary.push(`â€¢ ${projectName}: ì‹ ê·œ ${counts.ì‹ ê·œ}ê±´ / ì™„ë£Œ ${counts.ì²˜ë¦¬ì™„ë£Œ}ê±´ / ì²˜ë¦¬ì¤‘ ${counts.ì²˜ë¦¬ì¤‘}ê±´ / ì”ì—¬ ${counts.ì”ì—¬}ê±´`);\n  }\n});\n\n// í˜ì´ì§€ ìƒë‹¨ì— ìš”ì•½ ì¶”ê°€\nallChildren.push({\n  object: 'block',\n  type: 'callout',\n  callout: {\n    rich_text: createRichText(slackSummary.join('\\n')),\n    icon: { type: 'emoji', emoji: 'ğŸ“Š' },\n    color: 'gray_background'\n  }\n});\n\n// êµ¬ë¶„ì„ \nallChildren.push({\n  object: 'block',\n  type: 'divider',\n  divider: {}\n});\n\nprojectsData.forEach((project, idx) => {\n  const { projectName, classified, counts } = project;\n  \n  if (!classified || !counts) {\n    return;\n  }\n  \n  // í”„ë¡œì íŠ¸ í—¤ë”© (heading_2)\n  allChildren.push({\n    object: 'block',\n    type: 'heading_2',\n    heading_2: {\n      rich_text: createRichText(`${projectName} (ì‹ ê·œ ${counts.ì‹ ê·œ}ê±´, ì™„ë£Œ ${counts.ì²˜ë¦¬ì™„ë£Œ}ê±´, ì²˜ë¦¬ì¤‘ ${counts.ì²˜ë¦¬ì¤‘}ê±´, ì”ì—¬ ${counts.ì”ì—¬}ê±´)`)\n    }\n  });\n  \n  // ì‹ ê·œ ì„¹ì…˜ (ìˆì„ ë•Œë§Œ ìƒì„¸ í‘œì‹œ)\n  if (counts.ì‹ ê·œ > 0) {\n    allChildren.push({\n      object: 'block',\n      type: 'heading_3',\n      heading_3: { rich_text: createRichText('ğŸ“‹ ì‹ ê·œ') }\n    });\n    allChildren.push(...createIssueBlocks(classified.ì‹ ê·œ, false, true));\n  }\n  \n  // ì²˜ë¦¬ ì™„ë£Œ ì„¹ì…˜ (ìˆì„ ë•Œë§Œ ìƒì„¸ í‘œì‹œ)\n  if (counts.ì²˜ë¦¬ì™„ë£Œ > 0) {\n    allChildren.push({\n      object: 'block',\n      type: 'heading_3',\n      heading_3: { rich_text: createRichText('âœ… ì²˜ë¦¬ ì™„ë£Œ') }\n    });\n    allChildren.push(...createIssueBlocks(classified.ì²˜ë¦¬ì™„ë£Œ, true, true));\n  }\n  \n  // ì²˜ë¦¬ ì¤‘ ì„¹ì…˜ (ìˆì„ ë•Œë§Œ ìƒì„¸ í‘œì‹œ)\n  if (counts.ì²˜ë¦¬ì¤‘ > 0) {\n    allChildren.push({\n      object: 'block',\n      type: 'heading_3',\n      heading_3: { rich_text: createRichText('ğŸ”„ ì²˜ë¦¬ ì¤‘') }\n    });\n    allChildren.push(...createIssueBlocks(classified.ì²˜ë¦¬ì¤‘, false, true));\n  }\n  \n  // ì”ì—¬ ì„¹ì…˜ (ìˆì„ ë•Œë§Œ ìƒì„¸ í‘œì‹œ)\n  if (counts.ì”ì—¬ > 0) {\n    allChildren.push({\n      object: 'block',\n      type: 'heading_3',\n      heading_3: { rich_text: createRichText('ğŸ“ ì”ì—¬') }\n    });\n    allChildren.push(...createIssueBlocks(classified.ì”ì—¬, false, true));\n  }\n  \n  // êµ¬ë¶„ì„  (ë§ˆì§€ë§‰ í”„ë¡œì íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°)\n  if (idx < projectsData.length - 1) {\n    allChildren.push({\n      object: 'block',\n      type: 'divider',\n      divider: {}\n    });\n  }\n});\n\n// ë¸”ë¡ì„ 100ê°œì”© ì²­í¬ë¡œ ë¶„í• \nconst childrenChunks = [];\nfor (let i = 0; i < allChildren.length; i += MAX_BLOCKS_PER_REQUEST) {\n  childrenChunks.push(allChildren.slice(i, i + MAX_BLOCKS_PER_REQUEST));\n}\n\n// ì²« ë²ˆì§¸ ì²­í¬ëŠ” í˜ì´ì§€ ìƒì„± ì‹œ ì‚¬ìš©, ë‚˜ë¨¸ì§€ëŠ” appendìš©\nconst firstChunk = childrenChunks[0] || [];\nconst appendChunks = childrenChunks.slice(1);\n\n// Notion API request body (í˜ì´ì§€ ìƒì„±ìš©)\nconst notionBody = {\n  parent: { database_id: notionDbId },\n  icon: {\n    type: 'emoji',\n    emoji: 'â›”'\n  },\n  properties: {\n    Name: { title: [{ text: { content: `[PMS ì¼ì¼ ë¦¬í¬íŠ¸] ${today}` } }] },\n    Date: { date: { start: today } },\n    Tags: { select: { name: 'PMS' } }\n  },\n  children: firstChunk\n};\n\nreturn [{\n  json: {\n    pageTitle: `[PMS ì¼ì¼ ë¦¬í¬íŠ¸] ${today}`,\n    notionBody: notionBody,\n    appendChunks: appendChunks,\n    slackSummary: slackSummary.join('\\n'),\n    today,\n    NOTION_DATABASE_ID: notionDbId,\n    SLACK_CHANNELS: slackChannels\n  }\n}];"
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000012",
      "name": "Generate Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2420,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.notion.com/v1/pages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "notionApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Notion-Version",
              "value": "2022-06-28"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.notionBody) }}",
        "options": {}
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000013",
      "name": "Create Notion Page",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2640,
        300
      ],
      "credentials": {
        "notionApi": {
          "id": "NOTION_CREDENTIAL_ID",
          "name": "Notion API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// í˜ì´ì§€ ìƒì„± í›„ ì¶”ê°€ ë¸”ë¡ append ì¤€ë¹„\nconst notionResponse = $input.first().json;\nconst reportData = $('Generate Report').first().json;\n\nconst pageId = notionResponse.id;\nconst appendChunks = reportData.appendChunks || [];\n\nif (appendChunks.length === 0) {\n  return [{\n    json: {\n      pageId,\n      pageUrl: notionResponse.url,\n      appendComplete: true,\n      slackSummary: reportData.slackSummary,\n      today: reportData.today,\n      SLACK_CHANNELS: reportData.SLACK_CHANNELS,\n      pageTitle: reportData.pageTitle\n    }\n  }];\n}\n\nreturn appendChunks.map((chunk, idx) => ({\n  json: {\n    pageId,\n    pageUrl: notionResponse.url,\n    chunkIndex: idx,\n    chunkTotal: appendChunks.length,\n    children: chunk,\n    slackSummary: reportData.slackSummary,\n    today: reportData.today,\n    SLACK_CHANNELS: reportData.SLACK_CHANNELS,\n    pageTitle: reportData.pageTitle\n  }\n}));"
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000016",
      "name": "Prepare Append Chunks",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2860,
        300
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "condition-append",
              "leftValue": "={{ $json.children ? $json.children.length : 0 }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000017",
      "name": "Has More Blocks?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        3080,
        300
      ]
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://api.notion.com/v1/blocks/{{ $json.pageId }}/children",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "notionApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Notion-Version",
              "value": "2022-06-28"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ children: $json.children }) }}",
        "options": {}
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000018",
      "name": "Append Blocks to Page",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3300,
        200
      ],
      "credentials": {
        "notionApi": {
          "id": "NOTION_CREDENTIAL_ID",
          "name": "Notion API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Append ì™„ë£Œ í›„ ë˜ëŠ” Append ë¶ˆí•„ìš” ì‹œ Slack ì „ì†¡ ì¤€ë¹„\nconst allItems = $input.all();\n\n// ì²« ë²ˆì§¸ ì•„ì´í…œì—ì„œ ë°ì´í„° ì¶”ì¶œ (ëª¨ë‘ ë™ì¼í•œ í˜ì´ì§€ ì •ë³´)\nconst firstItem = allItems[0].json;\n\n// Prepare Append Chunksì—ì„œ ì˜¨ ë°ì´í„° ë˜ëŠ” Append Blocksì—ì„œ ì˜¨ ë°ì´í„°\nlet pageUrl, slackSummary, today, slackChannels, pageTitle;\n\nif (firstItem.pageUrl) {\n  // Prepare Append Chunksì—ì„œ ì§ì ‘ ì˜¨ ê²½ìš° (append ë¶ˆí•„ìš”)\n  pageUrl = firstItem.pageUrl;\n  slackSummary = firstItem.slackSummary;\n  today = firstItem.today;\n  slackChannels = firstItem.SLACK_CHANNELS;\n  pageTitle = firstItem.pageTitle;\n} else {\n  // Append Blocks í›„ ì˜¨ ê²½ìš°\n  const reportData = $('Generate Report').first().json;\n  const createResponse = $('Create Notion Page').first().json;\n  pageUrl = createResponse.url;\n  slackSummary = reportData.slackSummary;\n  today = reportData.today;\n  slackChannels = reportData.SLACK_CHANNELS;\n  pageTitle = reportData.pageTitle;\n}\n\nreturn slackChannels.map(channel => ({\n  json: {\n    channel,\n    slackSummary,\n    today,\n    notionPageUrl: pageUrl,\n    pageTitle\n  }\n}));"
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000019",
      "name": "Prepare Slack Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3520,
        300
      ]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "mode": "name",
          "value": "={{ $json.channel }}"
        },
        "text": "=ğŸ“‹ *PMS ì¼ì¼ ë¦¬í¬íŠ¸* ({{ $json.today }})\n\n{{ $json.slackSummary }}\n\nğŸ”— <{{ $json.notionPageUrl }}|ìƒì„¸ ë³´ê¸°>",
        "otherOptions": {}
      },
      "id": "a1b2c3d4-0001-0001-0001-000000000015",
      "name": "Send Slack Message",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [
        3080,
        300
      ],
      "credentials": {
        "slackApi": {
          "id": "SLACK_CREDENTIAL_ID",
          "name": "Slack API"
        }
      }
    }
  ],
  "connections": {
    "Error Trigger": {
      "main": [
        [
          {
            "node": "Format Error Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Error Message": {
      "main": [
        [
          {
            "node": "Send Error to Slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Determine Base Date",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Morning": {
      "main": [
        [
          {
            "node": "Determine Base Date",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Friday PM": {
      "main": [
        [
          {
            "node": "Determine Base Date",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Determine Base Date": {
      "main": [
        [
          {
            "node": "Should Run?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Should Run?": {
      "main": [
        [
          {
            "node": "Set Config",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Set Config": {
      "main": [
        [
          {
            "node": "Get Login Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Login Page": {
      "main": [
        [
          {
            "node": "Extract CSRF Token",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract CSRF Token": {
      "main": [
        [
          {
            "node": "Login to Redmine",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Login to Redmine": {
      "main": [
        [
          {
            "node": "Extract Session Cookies",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Session Cookies": {
      "main": [
        [
          {
            "node": "Split Projects",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Projects": {
      "main": [
        [
          {
            "node": "Get Issues Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Issues Page": {
      "main": [
        [
          {
            "node": "Parse Issues HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Issues HTML": {
      "main": [
        [
          {
            "node": "Classify Issues",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Classify Issues": {
      "main": [
        [
          {
            "node": "Aggregate Projects",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Projects": {
      "main": [
        [
          {
            "node": "Generate Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Report": {
      "main": [
        [
          {
            "node": "Create Notion Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Notion Page": {
      "main": [
        [
          {
            "node": "Prepare Append Chunks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Append Chunks": {
      "main": [
        [
          {
            "node": "Has More Blocks?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has More Blocks?": {
      "main": [
        [
          {
            "node": "Append Blocks to Page",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Slack Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append Blocks to Page": {
      "main": [
        [
          {
            "node": "Prepare Slack Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Slack Message": {
      "main": [
        [
          {
            "node": "Send Slack Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-12-07T00:00:00.000Z",
  "versionId": "1"
}